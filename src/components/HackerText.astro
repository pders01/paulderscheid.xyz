---
interface Props {
    text: string;
    className?: string;
}

const { text, className = "" } = Astro.props;
---

<span class={`hacker-text ${className}`} data-value={text}>{text}</span>

<script>
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%^&*";

    class HackerTextEffect {
        element: HTMLElement;
        originalText: string;
        interval: number | null = null;

        constructor(element: HTMLElement) {
            this.element = element;
            this.originalText = element.dataset.value || "";

            this.element.addEventListener("mouseenter", this.startEffect.bind(this));
        }

        startEffect() {
            let iteration = 0;

            if (this.interval) clearInterval(this.interval);

            this.interval = window.setInterval(() => {
                this.element.innerText = this.originalText
                    .split("")
                    .map((_, index) => {
                        if (index < iteration) {
                            return this.originalText[index];
                        }
                        return letters[Math.floor(Math.random() * letters.length)];
                    })
                    .join("");

                if (iteration >= this.originalText.length) {
                    if (this.interval) clearInterval(this.interval);
                }

                iteration += 1 / 3;
            }, 30);
        }
    }

    // Initialize on load and after view transitions
    const init = () => {
        document.querySelectorAll(".hacker-text").forEach((el) => {
            new HackerTextEffect(el as HTMLElement);
        });
    };

    init();
    document.addEventListener("astro:page-load", init);
</script>
